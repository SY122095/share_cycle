# share_cycle

## データ
1. station.csv: 各サイクルステーションで1時間ごとに記録された利用可能な自転車数（目的変数）の履歴データ
2. status.csv: 利用者がシェアサイクルで移動した時間、起点駅、終点駅等を記録した移動履歴データ
3. trip.csv: サイクルステーションの緯度・経度、ドック数（最大で停められる自転車数）、設置日のデータ
4. weather.csv: 都市中心部における1日ごとの気象予報データ(0時時点)

## EDA
### Status
- 利用可能台数(目的変数)と時間情報、ステーションid等があり欠損値はなし(利用可能台数が欠損となっているレコードは予測対象)
- 2013/9/1~2015/8/31のデータ
- 予測対象は2014/9/1以降
- 2013/9/1~2014/8/31はすべて予測対象ではないため、学習データとしてモデル構築に用いる
- 2014/9/1~2015/8/31のうち予測対象でないものを検証用データとして用いる
- 空き台数は徐々に減っていっている(≒効率的になっている)傾向にある
- 時間帯別の空き台数に関して全体的には日中が少なく早朝と深夜は多い傾向にあるが、ステーションによって異なる(ピークが日中or夜間)
### Station
- 全70ステーションの位置情報、設置されている都市、導入日、ドック数(最大で停められる自転車数)が格納されている
- 欠損値はなし
- 都市はcity1~city5までの5種類, ドック数は27,15,11,19,25,23の6パターン
- 最も古いステーションは2013/8/5設置、最も新しいステーションは2014/4/9設置
- 6個のステーションを除いて2013年8月に設置されている
### Trip
- 利用時間、利用開始時間、利用開始ステーション、利用終了時間、利用終了ステーション、自転車ID、サブスクリプションの種類が格納されている
- 欠損値はなし
- 期間はStatusと同じ
- 自転車は700種類で自転車ごとに利用回数に差がある
- サブスクリプションは2種類(定額プラン、一時利用)で比率は約5:1
- 一時利用者のほうが定額プラン利用者よりも平均利用時間が長い(それぞれ3952分、590分)
- 9割以上のケースで貸出ステーションと返却ステーションが異なる
- 貸出ステーションと返却ステーションが異なる場合のほうが利用時間が短い
- 貸出ステーションと返却ステーションが同じケースでは一時利用者が多い
### Weather
- 降雨量や風速など様々な天候データが格納されている
- eventsカラムには雨か霧の場合のみ値が格納されている
### Status & Station
- 学習期間のStatusとStationをidで結合
- 空車率は時間帯や都市、曜日によって変わらないがステーションによっては異なる(例: station58は日中に使用率が高い)
### Status & Station & Weather
- 前述の結合データにさらにWeatherを結合
- 全体の10%が雨、1%が霧であるが、天候によって空車台数はかわらない

## モデル構築
### データ分割
- 7日前までの情報を用いるためデータセットを2013/9/8以降に限定する
- 2013/9/8~2014/8/31: 学習データ
- 2014/9/1~2015/8/31, predicti=1: テストデータ
- 2014/9/1~2015/8/31, predicti=0: 検証データ
### 特徴量生成
- 雨、霧の日を1, その他の日を0とするダミー変数
- 都市名をラベルエンコーディング
- 返却数などのデータをドック数で割る
- 時刻が9-16時の間であれば1をとるダミー変数
### Light GBMで予測
- kfoldにより交差検証を行う
- 最終的な予測値は5つのモデルにより算出された予測値の平均とする
- RMSEは3.54前後
